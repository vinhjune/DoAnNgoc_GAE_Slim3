jQuery.extend({currency:{code:null,list:null,options:{selector:".currency",show_symbol:!0,number_decimals:2},getCurrent:function(){return $.currency.code},getSymbol:function(a){if($.currency.list[a]===undefined)return a;return $.currency.list[a].symbol},getLabel:function(a){if($.currency.list[a]===undefined)return a;return $.currency.list[a].label},change:function(a,b){var c=$.currency.code;$.currency.code=a,$(document).trigger("beforeChange.currency",[a]),$.currency.paint(a);var d="code=";typeof b!="undefined"&&(d="settleCurrency="),d+=a,$.ajax({async:!1,type:"POST",url:"/currency/session",data:d}),typeof b=="undefined"&&(document.cookie="currency="+a+"; path=/"),$(document).trigger("onChange",[a]),$(document).trigger("afterChange.currency",[a])},paint:function(a){$.currency.code=a;($.currency.list[$.currency.code]!==undefined||$.currency.loadCurrency(a)!==!1)&&$($.currency.options.selector).each(function(b){var c=$("#"+this.id+"_code").val();if(c!==undefined){if($.currency.list[c]===undefined&&$.currency.loadCurrency(c)===!1)return;var d=$("#"+this.id+"_amount").val(),e=$("#"+this.id+"_symbol").val(),f=$("#"+this.id+"_decimals").val();e===undefined&&(e=$.currency.options.show_symbol),f===undefined&&(f=$.currency.options.number_decimals);var g=d;c!=a?g=$.currency.convert(c,a,d,f):g=$.currency.round(g,f),parseInt(e)&&(g=$.currency.getSymbol(a)+g),$(this).html(g)}})},convert:function(a,b,c,d){d===undefined&&(d=2);var e=c;if(a!=b){if($.currency.list[a]===undefined&&$.currency.loadCurrency(a)===!1)return;if($.currency.list[b]===undefined&&$.currency.loadCurrency(b)===!1)return;e=e*$.currency.list[b].toEUR*$.currency.list[a].fromEUR*1.05}e=$.currency.round(e,d);return e},round:function(a,b){b===undefined&&(b=$.currency.options.number_decimals);var c=parseFloat(a);switch(b){case null:return c;case"floor":return Math.floor(c);case"ceil":return Math.ceil(c);default:return c.toFixed(b)}},loadCurrency:function(a){var b=this,c=$.ajax({async:!1,type:"GET",url:"/currency",data:"code="+a,dataType:"json",success:function(c){b.list[a]=c.currency}});return c.status==200},display:function(a,b,c,d){d===undefined&&(d=$.currency.options.number_decimals),$.currency.list[$.currency.code]===undefined&&$.currency.loadCurrency($.currency.code),$.currency.list[b]===undefined&&$.currency.loadCurrency(b);var e=$.currency.convert(b,$.currency.code,c,d),f='<span id="'+a+'" class="currency">'+$.currency.list[$.currency.code].symbol+e+"</span>"+'<input type="hidden" id="'+a+'_code" value="'+b+'" />'+'<input type="hidden" id="'+a+'_amount" value="'+c+'" />'+'<input type="hidden" id="'+a+'_decimals" value="'+d+'" />';return f}}}),$(function(){function b(){checked=$("#noDate").attr("checked"),checked?$("#tour-search-form .fld_3").addClass("fld_3_disabled"):$("#tour-search-form .fld_3").removeClass("fld_3_disabled")}var a=HwReg.get("TourCities");$("#selectCountry").change(function(){var b=$("#selectCountry").val();if(b!=""){var c=a[b];$("#selectCity")[0].length=1,$("#selectCity")[0].options[0].selected=!0;for(i=0;i<c.length;i++)$("#selectCity")[0].length=i+1,opt=new Option(c[i]),opt.value=c[i],$("#selectCity")[0].options[i+1]=opt;$("#keywords").val("Search for a City, Tour or Category")}else $("#selectCity")[0].length=1,$("#selectCity")[0].options[0].selected=!0,$("#selectCity")[0].length=2,$("#selectCity")[0].options[1]=new Option("Choose country first")}),$("#tour-search-submit").click(function(){$("#tour-search-form").submit();return!1}),$("#noDate").change(function(){b()}),b()}),$(function(){function e(){var a=$("#keywords")[0].autocompleter,b=a.findValue();return!1}function d(a){b(a)}function c(a){var b=a[0],c=a[1];if(c=="CITIES"||c=="COUNTRIES"||c=="TOURS"||c=="CATEGORIES"){c=="CITIES"?b="<b><u>Cities</u></b>":c=="COUNTRIES"?b="<b><u>Countries</u></b>":c=="TOURS"?b="<b><u>Tours</u></b>":c=="CATEGORIES"&&(b="<b><u>Categories</u></b>");return b}return b}function b(a){if(a==undefined||a==null)return!1;var b=!1;a.extra?b=a.extra[0]:b=a.selectValue;if(b.substring(0,4)=="tour")id=b.replace(/tour:/,""),$("#search_id").val(id),$("#search_type").val("tour");else if(b=="city"||b=="category"||b=="country")$("#search_id").val(a.innerHTML),$("#search_type").val(b)}$("#loading").hide().ajaxStart(function(){$("#spinner").remove()}).ajaxStop(function(){$(this).hide()});var a=$("#keywords").val();$("#tour-search-form,#sb-search").submit(function(){var b=$("#keywords").val(),c=HwReg.get("controller"),d=HwReg.get("action");if(c=="tours"&&d=="index"&&(b==""||b==a)&&$("#selectCountry").val()==""){$("#searchTooltip").fadeIn("slow"),$("#keywords").val(a);return!1}}),$("#selectCountry, #selectCity, #keywords").focus(function(){$("#searchTooltip").fadeOut("slow")}),$("#keywords").click(function(){$("#selectCountry option:eq(0), #selectCity option:eq(0)").attr("selected",!0),$(this).val()==a&&$(this).val(""),$("#nights-select-wrap").hide(),$("#guests-select-wrap").hide()}).focusout(function(){$(this).val()||$(this).val(a)}),$("#keywords").change(function(){$("#search_type").val(""),$("#search_id").val("")}),$("#keywords").autocomplete(HwReg.get("currentBaseUrl")+"/tours/suggestionslist",{getParamName:"keywords",extraParams:{headings:1},delay:300,minChars:2,enableCaching:0,cacheLength:1,matchSubset:1,matchCase:0,matchContains:1,cacheLength:10,onItemSelect:d,onFindValue:b,formatItem:c,autoFill:!1}),Date.firstDayOfWeek=1,Date.format="dd mmm yyyy",$("#date_from").datePicker({clickInput:!0,createButton:!1})})